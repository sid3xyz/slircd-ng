# slircd-ng Test Configuration
#
# This configuration simulates a real IRC server but with relaxed rate limits
# for localhost connections to enable automated testing.
#
# Usage:
#   cargo run -p slircd-ng -- config.test.toml
#
# This server runs on:
#   - IRC: localhost:6667 (plaintext)
#   - Metrics: disabled (set metrics_port = 9090 to enable)

[server]
name = "My.Little.Server"
network = "TestNet"
sid = "001"
description = "slircd-ng Test Server"
metrics_port = 0                      # Set to 9090 to enable Prometheus metrics

[listen]
address = "0.0.0.0:6667"

# For TLS testing, uncomment and provide certs:
#
# [tls]
# address = "0.0.0.0:6697"
# cert_path = "certs/server.crt"
# key_path = "certs/server.key"

[database]
path = ":memory:" # In-memory for tests, or use "slircd-test.db" for persistence

[security]
# Strong test secret - meets entropy requirements (3+ char classes, 8+ unique chars)
# For actual production, generate with: openssl rand -hex 32
cloak_secret = "TestEnv-Secure-Secret-2026-X9!kL"
cloak_suffix = "test"
spam_detection_enabled = false                        # Disable spam filtering for tests

[security.rate_limits]
# Relaxed rate limits for automated testing
# In production, use much lower values (e.g., 2, 3, 5)
message_rate_per_second = 1000 # Messages per second per client
connection_burst_per_ip = 1000 # Connections per IP in burst window
join_burst_per_client = 1000   # Channel joins per client in burst window

[motd]
# MOTD can be set inline or from a file
lines = [
    "Welcome to the slircd-ng Test Server!",
    "",
    "This server is configured for testing purposes.",
    "Rate limits are relaxed for localhost connections.",
    "",
    "For production use, please use appropriate security settings.",
]

# Test operator account - DO NOT USE IN PRODUCTION
# Password: "testpass" (in production, use hashed passwords)
[[oper]]
name = "testoper"
password = "testpass"
hostmask = "*@*"

# Account registration settings for testing
# Note: before_connect is intentionally set to false to pass compliance tests
# that verify the server correctly rejects before-connect registration when disabled
[account_registration]
enabled = true
before_connect = false     # Test that server correctly enforces this restriction
email_required = false
custom_account_name = true

[sasl]
enabled = true
mechanisms = ["PLAIN", "SCRAM-SHA-256"]

[multiclient]
enabled = true
max_sessions_per_account = 100
always_on = "opt-in"
always_on_expiration = "30d"
auto_away = "opt-in"

[history]
enabled = true
backend = "redb"
path = "data/history-test.redb"
